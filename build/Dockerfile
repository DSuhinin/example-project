#
# Build arguments.
#
ARG GOSUMDB=off
ARG GO_SERVICE_IMPORT_PATH=unknown
ARG GOPROXY=$GOPROXY
ARG GO111MODULE=$GO111MODULE
ARG PATH_GO_SOURCES=/go/src/$GO_SERVICE_IMPORT_PATH

#
# Build Go binary inside base container.
#
FROM golang:1.16
# Stage arguments
ARG PATH_GO_SOURCES
ARG GO_SERVICE_IMPORT_PATH
# Env variables.
ENV GOSUMDB=$GOSUMDB
ENV GOPROXY=$GOPROXY
ENV GO111MODULE=$GO111MODULE

RUN mkdir -p $GO_SERVICE_IMPORT_PATH/
WORKDIR $PATH_GO_SOURCES
COPY . $PATH_GO_SOURCES
# Build
RUN make go_get
RUN make go_build

# Container settings.
EXPOSE 8080
ENTRYPOINT ["./currency-exchange-service"]
